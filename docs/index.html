---
layout: "contribution"
title: 主页
---

<style>
#submit-region {
    margin: 20px 0px;
}
#submit {
    width: 80px;
    height: 30px;
    border-radius: 15px;
    border: none;
    background-color: #0099ff;
    cursor: pointer;
}
#submit:hover {
    background-color: #007ccf;
}
#submit:active {
    background-color: #0069af;
}
</style>

<h1>投稿页面</h1>

<p>首先欢迎您为火刊投稿！</p>

<p>在投稿之前，建议您先阅读<a href="{{site.baseurl}}/standard.html">火刊投稿规范</a>，以便您的投稿内容能够被正确的排版和显示。</p>

<p><strong>标题：</strong><input type="text" name="title" placeholder="无题" /></p>

<p><strong>作者：</strong><input type="text" name="author" placeholder="匿名" /></p>

<p><strong>排版方式：</strong><select name="format">
    <option value="011">文章（首行缩进）</option>
    <option value="111">文章（首行不缩进）</option>
    <option value="010">诗歌（居中）</option>
    <option value="110">诗歌（不居中）</option>
    <option value="-">自定义</option>
</select>&nbsp;&nbsp;<a href="{{site.baseurl}}/formats.html"><i class="fa-regular fa-circle-question" style="color: #606060;"></i></a></p>

<p><strong>正文：</strong></p>
<div id="editor"></div>

<div id="submit-region"><button type="button" id="submit" onclick="submit();"><strong>提交</strong></button></div>

<script>
    var quill = new Quill('#editor', {
        modules: {
            toolbar: [
                [ 'bold', 'italic' ]
            ]
        },
        placeholder: '在此输入正文',
        theme: 'snow'
    });

    function submit() {
        document.getElementById('submit-region').innerHTML = `<i class="fa-solid fa-circle-notch fa-spin" style="font-size: 1.5em;"></i>`;
        var
        title = document.getElementsByName('title')[0].value || '无题',
        author = document.getElementsByName('author')[0].value || '匿名',
        format = document.getElementsByName('format')[0].value;
        var lines = quill.getLines();
        var formatted = '';
        var original = '';
        for (var line of lines) {
            if (line.cache.delta.length() === 1 && line.cache.delta.ops[0].insert === '\n') {
                original += `\n`;
                if (format === '-') {
                    continue;
                }
                if (format === '011' || format === '111') {
                    formatted += `\\vspace{1em}\n\n`;
                }
                else {
                    formatted += `\n`;
                }
            }
            else {
                for (var op of line.cache.delta.ops) {
                    var insert = op.insert;
                    if (op.attributes) {
                        if (op.attributes.italic) {
                            insert = `\\textit{` + insert + `}`;
                        }
                        if (op.attributes.bold) {
                            insert = `\\textbf{` + insert + `}`;
                        }
                    }
                    original += insert;
                    if (format === '-') {
                        continue;
                    }
                    if (format === '011' || format === '111') {
                        insert = insert.replace(/\n/g, '\n\n');
                    }
                    else {
                        insert = insert.replace(/\n/g, `\\\\\n`);
                    }
                    formatted += insert;
                }
            }
        }
        if (format !== '-') {
            if (format === '111' || format === '110') {
                formatted = `\\noind\n\n` + formatted + `\\ind\n\n`;
            }
            if (format === '010') {
                formatted = `\\begin{center}\n` + formatted + `\\end{center}\n\n`;
            }
            formatted = `\\headline{` + title + `}\n\n` + formatted + `\\byline{` + author + `}`;
        }
        original = `<h2>` + title + `</h2>` + original + `\n（作者：` + author + `）`;
        emailBody = `<h1>ORIGINAL</h1>` + original;
        if (format === '-') {
            emailBody += `<h1>AUTOFORMAT DISABLED</h1>`;
        }
        else {
            emailBody += `<h1>FORMATTED</h1>` + formatted;
        }
        emailBody = emailBody.replace(/\n/g, `<br>`);
        Email.send({
            Host: 'smtp.qq.com',
            Username: 'hanyx2006',
            Password: 'zyvhfiyajldnbihd',
            From: 'hanyx2006@qq.com',
            // To: 'huooooosheeeee@163.com',
            To: 'hanyx2006@qq.com',
            Subject: '自动投稿：' + title + ' - ' + author,
            Body: emailBody
        }).then(msg => {
            alert(msg);
            location.reload();
        });
    }
</script>
